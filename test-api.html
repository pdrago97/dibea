<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste API DIBEA</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .stat-card { background: #f5f5f5; padding: 20px; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 2em; font-weight: bold; color: #2563eb; }
        .stat-label { color: #666; margin-top: 5px; }
        .error { color: red; background: #ffe6e6; padding: 10px; border-radius: 4px; }
        .success { color: green; background: #e6ffe6; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste de Transpar√™ncia de Dados - DIBEA</h1>
        
        <div id="status">Carregando dados...</div>
        
        <h2>üìä Dados da Landing Page</h2>
        <div id="landing-stats" class="stats"></div>
        
        <h2>üîê Dados do Dashboard Admin</h2>
        <div id="admin-stats" class="stats"></div>
        
        <h2>üîç Compara√ß√£o de Dados</h2>
        <div id="comparison"></div>
        
        <h2>üìù Log de Requisi√ß√µes</h2>
        <div id="log"></div>
    </div>

    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message) {
            const p = document.createElement('p');
            p.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            log.appendChild(p);
        }
        
        function createStatCard(label, value) {
            return `
                <div class="stat-card">
                    <div class="stat-value">${value}</div>
                    <div class="stat-label">${label}</div>
                </div>
            `;
        }
        
        async function testLandingStats() {
            try {
                addLog('Testando API da Landing Page...');
                const response = await fetch('http://localhost:3000/api/v1/landing/stats');
                const data = await response.json();
                
                document.getElementById('landing-stats').innerHTML = `
                    ${createStatCard('Total de Animais', data.totalAnimals)}
                    ${createStatCard('Animais Adotados', data.adoptedAnimals)}
                    ${createStatCard('Munic√≠pios Ativos', data.totalMunicipalities)}
                    ${createStatCard('Usu√°rios Registrados', data.totalUsers)}
                `;
                
                addLog('‚úÖ Landing Page API funcionando');
                return data;
            } catch (error) {
                addLog(`‚ùå Erro na Landing Page API: ${error.message}`);
                return null;
            }
        }
        
        async function testAdminStats() {
            try {
                addLog('Fazendo login como admin...');
                const loginResponse = await fetch('http://localhost:3000/api/v1/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: 'admin@dibea.com', password: 'admin123' })
                });
                
                const loginData = await loginResponse.json();
                const token = loginData.token;
                
                addLog('‚úÖ Login realizado com sucesso');
                addLog('Testando API do Dashboard Admin...');
                
                const response = await fetch('http://localhost:3000/api/v1/admin/dashboard/stats', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                
                document.getElementById('admin-stats').innerHTML = `
                    ${createStatCard('Total de Animais', data.totalAnimals)}
                    ${createStatCard('Animais Dispon√≠veis', data.availableAnimals)}
                    ${createStatCard('Animais Adotados', data.adoptedAnimals)}
                    ${createStatCard('Total de Usu√°rios', data.totalUsers)}
                    ${createStatCard('Usu√°rios Ativos', data.activeUsers)}
                    ${createStatCard('Taxa de Ado√ß√£o', data.adoptionRate + '%')}
                `;
                
                addLog('‚úÖ Dashboard Admin API funcionando');
                return data;
            } catch (error) {
                addLog(`‚ùå Erro na Dashboard Admin API: ${error.message}`);
                return null;
            }
        }
        
        async function compareData(landingData, adminData) {
            if (!landingData || !adminData) {
                document.getElementById('comparison').innerHTML = '<div class="error">N√£o foi poss√≠vel comparar os dados devido a erros nas APIs</div>';
                return;
            }
            
            const comparisons = [
                { field: 'totalAnimals', landing: landingData.totalAnimals, admin: adminData.totalAnimals },
                { field: 'adoptedAnimals', landing: landingData.adoptedAnimals, admin: adminData.adoptedAnimals },
                { field: 'totalUsers', landing: landingData.totalUsers, admin: adminData.totalUsers }
            ];
            
            let allMatch = true;
            let comparisonHTML = '<table border="1" style="width: 100%; border-collapse: collapse;"><tr><th>Campo</th><th>Landing Page</th><th>Dashboard Admin</th><th>Status</th></tr>';
            
            comparisons.forEach(comp => {
                const match = comp.landing === comp.admin;
                if (!match) allMatch = false;
                
                comparisonHTML += `
                    <tr style="background: ${match ? '#e6ffe6' : '#ffe6e6'}">
                        <td>${comp.field}</td>
                        <td>${comp.landing}</td>
                        <td>${comp.admin}</td>
                        <td>${match ? '‚úÖ Consistente' : '‚ùå Inconsistente'}</td>
                    </tr>
                `;
            });
            
            comparisonHTML += '</table>';
            
            if (allMatch) {
                comparisonHTML = '<div class="success">üéâ TODOS OS DADOS EST√ÉO CONSISTENTES!</div>' + comparisonHTML;
                addLog('üéâ Transpar√™ncia de dados CONFIRMADA - todos os valores s√£o consistentes');
            } else {
                comparisonHTML = '<div class="error">‚ö†Ô∏è DADOS INCONSISTENTES DETECTADOS!</div>' + comparisonHTML;
                addLog('‚ö†Ô∏è Inconsist√™ncias detectadas nos dados');
            }
            
            document.getElementById('comparison').innerHTML = comparisonHTML;
        }
        
        async function runTests() {
            status.textContent = 'Executando testes...';
            addLog('üöÄ Iniciando testes de transpar√™ncia de dados');
            
            const landingData = await testLandingStats();
            const adminData = await testAdminStats();
            
            await compareData(landingData, adminData);
            
            status.textContent = 'Testes conclu√≠dos!';
            addLog('‚úÖ Testes conclu√≠dos');
        }
        
        // Executar testes automaticamente
        runTests();
    </script>
</body>
</html>
